# PVE 网络设置

## wifi 网络设置

> 默认情况下，PVE (或者 Debian 服务器) 环境下网络连接管理工具使用的是 `networking` 而不是 `NetworkManager`，以下均以 `networking` 来进行操作。

### 查看并启用 wifi 网卡

查看 wifi 网卡状态 (这里 wifi 网卡名为 `wlp2s0`)：

```sh
ip a

# 找到无线网卡
3: wlp2s0: <BROADCAST,MULTICAST> mtu 1500 qdisc noqueue state DOWN group default qlen 1000
    link/ether 00:21:5c:be:92:ae brd ff:ff:ff:ff:ff:ff
    inet 192.168.1.212/24 scope global wlp2s0
       valid_lft forever preferred_lft forever
```

从无线网卡的信息中可以看到 `DOWN`，说明无线网卡尚未启用，使用以下命令启用：

```sh
ip link set wlp2s0 up
```

### 查看并连接 wifi

#### 查看可用的 wifi 连接信息

首先安装 `wireless-tools`:

```sh
apt install -y wireless-tools
```

输入以下命令查看可用的 wifi 连接信息 （这里假设无线网卡名称为 `wlp2s0`）：

```sh
iwlist wlp2s0 scan
# 也可以加上过滤条件，只需要 ESSID 名称即可
# iwlist wlp2s0 scan | grep ESSID
```

复制想要连接的 wifi 的 ESSID，即 wifi 的名称。

#### 连接 wifi

选择某个 wifi 名称之后，一般情况下还需要对明文的 wifi 连接密码生成 `psk` 密码，运行以下命令安装依赖包：

```sh
apt install -y wpasupplicant
```

然后输入以下命令将明文密码生成 `psk` 密码（将 `WiFi-Name-SSID` 改为想要连接的 wifi 名称，`wifi_password` 改为明文的 wifi 连接密码）：

```sh
wpa_passphrase WiFi-Name-SSID "wifi_password"

# 输出结果示例如下：
network={
	ssid="CMCC-udTS-5G"
	#psk="3yh2d65p"
	psk=c8cc4171fa2899e2d4e8b720dcb6cae6b509a593141fba6cd89ff718bd3fef09
}
```

将 `psk` 的值复制出来，然后修改 `/etc/network/interfaces` 文件，新增或者修改 `wlp2s0` 的连接信息中的 `wpa-ssid` 、`wpa-psk` 为对应的 wifi 名称和 psk 密码 ：

```sh
auto wlp2s0
iface wlp2s0 inet dhcp
    wpa-ssid YourSSID
    wpa-psk YourPassword
```

### 查看 wifi 网卡连接状态

输入以下命令查看 wifi 网卡信息：

```sh
ip a

# 查找到 wifi 网卡相关信息：
3: wlp2s0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default qlen 1000
    link/ether 00:21:5c:be:92:ae brd ff:ff:ff:ff:ff:ff
    inet 192.168.1.212/24 scope global wlp2s0
       valid_lft forever preferred_lft forever
    inet6 2409:8a1e:9122:63a0:221:5cff:febe:92ae/64 scope global dynamic mngtmpaddr
       valid_lft 175636sec preferred_lft 89236sec
    inet6 fe80::221:5cff:febe:92ae/64 scope link
       valid_lft forever preferred_lft forever
```

应该可以看到成功分配到了 IPV4 地址 (`inet` 中的地址)。

## 参考

[官方参考网址](https://pve.proxmox.com/wiki/Network_Configuration#_default_configuration_using_a_bridge)
